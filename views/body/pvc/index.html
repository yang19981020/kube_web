<div class="layui-body">
    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
        <legend>PVC</legend>
    </fieldset>

    <div class="layui-inline layui-row">
        <label class="layui-card layui-btn-fluid layui-inline">
            <span class="layui-card">namespace</span>
            <select class="" name="interest" lay-filter="aihao" id="namespace_list_id" onchange="pvcNamespaceChange(this.options[this.options.selectedIndex].text)"></select>
        </label>

    </div>

    <div class="layui-table-box">
        <div class="layui-table-header">
            <table cellspacing="0" cellpadding="0" border="0" class="layui-table">
                <thead>
                    <tr role="row">
                        <th class="sorting_asc" tabindex="0" aria-controls="example" rowspan="1" colspan="1" aria-sort="ascending" aria-label="Name: activate to sort column descending" style="width: 135.667px;">Name</th>
                        <th class="sorting" tabindex="0" aria-controls="example" rowspan="1" colspan="1" aria-label="Namespace: activate to sort column ascending" style="width: 96.6667px;">Namespace</th>
                        <th class="sorting" tabindex="0" aria-controls="example" rowspan="1" colspan="1" aria-label="Status: activate to sort column ascending" style="width: 56.6667px;">Status</th>
                        <th class="sorting" tabindex="0" aria-controls="example" rowspan="1" colspan="1" aria-label="Volume: activate to sort column ascending" style="width: 144.667px;">Volume</th>
                        <th class="sorting" tabindex="0" aria-controls="example" rowspan="1" colspan="1" aria-label="Capacity: activate to sort column ascending" style="width: 75.6667px;">Capacity</th>
                        <th class="sorting" tabindex="0" aria-controls="example" rowspan="1" colspan="1" aria-label="Access Modes: activate to sort column ascending" style="width: 120.667px;">Access Modes</th>
                    </tr>
                </thead>
                <tbody id="pvc_list_id">

                </tbody>
            </table>
        </div>
    </div>
    <button type="button" class="layui-btn layui-btn-lg">create</button>
</div>

<script type="text/javascript">
    $(document).ready(function (){
        // get namespace list
        var getNamespaceList = {
            "url": "/resource/namespace_list",
            "method": "GET",
            "timeout": 0,
        };
        $.ajax(getNamespaceList).done(function (response) {
            for (let i in response.data.items) {
                var namespace_list_id = document.getElementById("namespace_list_id");
                var namespace_option = document.createElement("option");
                namespace_option.innerText = response.data.items[i].metadata.name;
                namespace_option.id = response.data.items[i].metadata.name;
                namespace_option.value = response.data.items[i].metadata.name;
                if (response.data.items[i].metadata.name === "default") {
                    namespace_option.selected = true
                }
                namespace_list_id.appendChild(namespace_option);
            }
        });

        // get pod list
        var getPvcList = {
            "url": "/resource/pvc_list",
            "method": "GET",
            "timeout": 0,
        };
        $.ajax(getPvcList).done(function (response) {
            for (let i in response.data.items) {
                var pvc_list_id = document.getElementById("pvc_list_id");
                var pvc_list_tr = document.createElement("tr");
                pvc_list_tr.id = response.data.items[i].metadata.name
                pvc_list_id.appendChild(pvc_list_tr);

                var pvc_list_tr_td = document.getElementById(response.data.items[i].metadata.name);
                var pvc_list_tr_name = document.createElement("td");
                pvc_list_tr_name.id = response.data.items[i].metadata.name
                pvc_list_tr_name.innerText = response.data.items[i].metadata.name
                pvc_list_tr_td.appendChild(pvc_list_tr_name);

                var pvc_list_td_namespace = document.createElement("td");
                pvc_list_td_namespace.id = response.data.items[i].metadata.namespace
                pvc_list_td_namespace.innerText = response.data.items[i].metadata.namespace
                pvc_list_tr_td.appendChild(pvc_list_td_namespace);

                var pvc_list_td_status = document.createElement("td");
                pvc_list_td_status.id = response.data.items[i].status.phase;
                pvc_list_td_status.innerText = response.data.items[i].status.phase;
                pvc_list_tr_td.appendChild(pvc_list_td_status);

                var pv_list_td_volumeName = document.createElement("td");
                pv_list_td_volumeName.id = response.data.items[i].spec.volumeName
                pv_list_td_volumeName.innerText = response.data.items[i].spec.volumeName
                pvc_list_tr_td.appendChild(pv_list_td_volumeName);

                var pv_list_td_capacity = document.createElement("td");
                pv_list_td_capacity.id = response.data.items[i].status.capacity.storage
                pv_list_td_capacity.innerText = response.data.items[i].status.capacity.storage
                pvc_list_tr_td.appendChild(pv_list_td_capacity);

                var pv_list_td_accessModes = document.createElement("td");
                pv_list_td_accessModes.id = response.data.items[i].status.accessModes
                pv_list_td_accessModes.innerText = response.data.items[i].status.accessModes
                pvc_list_tr_td.appendChild(pv_list_td_accessModes);
            }
        });
    });

    var pvcNamespaceChange = function (tx){
        $("#pvc_list_id").html("");
        var getPvcList = {
            "url": "/resource/pvc_list?namespace="+tx,
            "method": "GET",
            "timeout": 0,
        };
        $.ajax(getPvcList).done(function (response) {
            for (let i in response.data.items) {
                var pvc_list_id = document.getElementById("pvc_list_id");
                var pvc_list_tr = document.createElement("tr");
                pvc_list_tr.id = response.data.items[i].metadata.name
                pvc_list_id.appendChild(pvc_list_tr);

                var pvc_list_tr_td = document.getElementById(response.data.items[i].metadata.name);
                var pvc_list_tr_name = document.createElement("td");
                pvc_list_tr_name.id = response.data.items[i].metadata.name
                pvc_list_tr_name.innerText = response.data.items[i].metadata.name
                pvc_list_tr_td.appendChild(pvc_list_tr_name);

                var pvc_list_td_namespace = document.createElement("td");
                pvc_list_td_namespace.id = response.data.items[i].metadata.namespace
                pvc_list_td_namespace.innerText = response.data.items[i].metadata.namespace
                pvc_list_tr_td.appendChild(pvc_list_td_namespace);

                var pvc_list_td_status = document.createElement("td");
                pvc_list_td_status.id = response.data.items[i].status.phase;
                pvc_list_td_status.innerText = response.data.items[i].status.phase;
                pvc_list_tr_td.appendChild(pvc_list_td_status);

                var pv_list_td_volumeName = document.createElement("td");
                pv_list_td_volumeName.id = response.data.items[i].spec.volumeName
                pv_list_td_volumeName.innerText = response.data.items[i].spec.volumeName
                pvc_list_tr_td.appendChild(pv_list_td_volumeName);

                var pv_list_td_capacity = document.createElement("td");
                pv_list_td_capacity.id = response.data.items[i].status.capacity.storage
                pv_list_td_capacity.innerText = response.data.items[i].status.capacity.storage
                pvc_list_tr_td.appendChild(pv_list_td_capacity);

                var pv_list_td_accessModes = document.createElement("td");
                pv_list_td_accessModes.id = response.data.items[i].status.accessModes
                pv_list_td_accessModes.innerText = response.data.items[i].status.accessModes
                pvc_list_tr_td.appendChild(pv_list_td_accessModes);
            }
        });
    };
</script>

